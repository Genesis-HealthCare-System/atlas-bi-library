/*
    Atlas of Information Management business intelligence library and documentation database.
    Copyright (C) 2020  Riverside Healthcare, Kankakee, IL

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.
*/
function buildInputs(){var n=document.querySelectorAll('input[type="nice-input"], textarea[type="nice-input"]');Array.prototype.forEach.call(n,function(n,t){hiddenInput=document.createElement(n.tagName);hiddenInput.style.display="none";hiddenInput.setAttribute("tabindex",3);hiddenInput.setAttribute("id",n.getAttribute("id"));hiddenInput.setAttribute("name",n.getAttribute("name"));hiddenInput.setAttribute("inputId",t);hiddenInput.setAttribute("tabindex","-1");hiddenInput.setAttribute("value",n.getAttribute("value"));hiddenInput.setAttribute("multiple","true");span=document.createElement("span");span.setAttribute("contenteditable","true");span.setAttribute("class",n.getAttribute("class"));span.setAttribute("inputId",t);span.setAttribute("data-initial-content",n.getAttribute("data-initial-content"));span.setAttribute("required",n.getAttribute("required"));span.textContent=n.getAttribute("value");wrapper=document.createElement("div");wrapper.classList.add("input-wrapper");wrapper.appendChild(span);wrapper.appendChild(hiddenInput);n.classList.contains("submit")&&(button=document.createElement("button"),button.classList.add("btn"),button.classList.add("btn-link"),button.classList.add("input-submit"),button.setAttribute("type","submit"),button.setAttribute("name","submit"),button.innerHTML="<span class='fas fa-paper-plane'><\/span>",wrapper.appendChild(button));container=document.createElement("div");container.classList.add("input-container");n.classList.contains("slim")&&container.classList.add("slim");container.appendChild(wrapper);n.parentNode.replaceChild(container,n)})}function buildAnalyticsPackage(n){return analytics={},analytics.appCodeName=navigator.appCodeName,analytics.appName=navigator.appName,analytics.appVersion=navigator.appVersion,analytics.cookieEnabled=navigator.cookieEnabled,analytics.language=navigator.language,analytics.oscpu=navigator.oscpu,analytics.platform=navigator.platform,analytics.userAgent=navigator.userAgent,analytics.host=location.host,analytics.hostname=location.hostname,analytics.href=location.href,analytics.protocol=location.protocol,analytics.search=location.search,analytics.pathname=location.pathname,analytics.hash=window.location.hash,analytics.screenHeight=window.innerHeight,analytics.screenWidth=window.innerWidth,analytics.origin=window.origin,analytics.title=document.title,analytics.referrer=document.referrer,analytics.loadTime=n||window.performance.timing.domContentLoadedEventEnd-window.performance.timing.navigationStart,analytics.zoom=window.devicePixelRatio,analytics}function postAnalytics(n){navigator.sendBeacon?navigator.sendBeacon("/analytics?handler=Beacon",JSON.stringify(buildAnalyticsPackage(n))):$.ajax({method:"post",url:"/analytics?handler=Beacon","async":!0,data:JSON.stringify(buildAnalyticsPackage(n)),contentType:"text/plain;charset=UTF-8"})}function CloseSearch(n){$(".search-results").addClass("search-results-hidden").html("");$('main[role="main"]').removeClass("main-hidden");$(".search-group input").val("");var t=$("<a>",{href:n})[0],i=t.pathname;i=="/"?$("#searchCollapse").collapse("show"):$("#searchCollapse").collapse("hide");myTop=123}function AjaxSearch(n){if(n.length>0){$(".search-history").hide();clearTimeout(timer);$("i.fa-search").removeClass("fa-search").addClass("fa-spinner fa-pulse");var t=n;$("main").find(".search").length>0?$('main[role="main"]').html(loader):($('main[role="main"]').addClass("main-hidden"),$(".search-results").removeClass("search-results-hidden"));StartProgress(90);searchAjax=$.ajax({method:"post",url:"/Search/Ajax",data:{s:t},beforeSend:function(n){n.overrideMimeType("text/plain; charset=x-user-defined");searchAjax!==null&&searchAjax.abort()}}).done(function(n){FinishProgress();$("main").find(".search").length>0?$('main[role="main"]').html(n).find("#close-search").remove():$(".search-results").html(n);document.title="Search - "+t+" - Atlas";history.pushState("",document.title,window.location.origin+"/Search?s="+encodeURI(t));currentPathname=document.location.pathname;$("i.fa-spinner").removeClass("fa-spinner").removeClass("fa-pulse").addClass("fa-search");timer=setTimeout(postAnalytics,3e3)})}else $(".search-results").addClass("search-results-hidden").html(""),$('main[role="main"]').removeClass("main-hidden"),document.title=lastTitle,history.pushState({state:"ajax"},lastTitle,lastState.href),currentPathname=lastState.pathname,myTop=123}function setCookie(n,t,i){var u="",r;i?(r=new Date,r.setTime(r.getTime()+i*864e5),u="; expires="+r.toUTCString()):(r=new Date,r.setTime(r.getTime()+864e5),u="; max-age="+r.toUTCString());document.cookie=n+"="+(t||"")+u+"; path=/"}function getCookie(n){for(var t,r=n+"=",u=document.cookie.split(";"),i=0;i<u.length;i++){for(t=u[i];t.charAt(0)==" ";)t=t.substring(1,t.length);if(t.indexOf(r)===0)return t.substring(r.length,t.length)}return null}function DynamicDropdownLoad(){buildHtml();loadGetList();$(".dynamic-dropdown-input").each(function(){setWidth($(this))})}function loadCheckbox(){$(".checkbox-list").each(function(){var n=$(this).find(".checkbox-container"),t=$(this).find("select");n.each(function(){completed=$(this).find(".completed").length>0?'selected="selected"':"";t.append('<option value="'+$(this).attr("check-id")+'" '+completed+"><\/option")})})}function getUrlVars(){var n={},t=window.location.href.split("#")[0].replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,i,r){n[i]=r});return n}function StartProgress(){var n=$(".atlas-progress");n.find(".progress-bar").attr("aria-valuenow")=="100"&&(n.hide().find(".progress-bar").css("transition","width 0s").css("width","0%").attr("aria-valuenow","0").show(),n.show().find(".progress-bar").css("transition","width .6s ease"));typeof interval!="undefined"&&clearInterval(interval);typeof resetTimeout!="undefined"&&clearTimeout(resetTimeout);interval=setInterval(function(){current_progress+=step;n=Math.round(Math.atan(current_progress)/(Math.PI/2)*1e5)/1e3;$(".progress-bar").css("width",n+"%").attr("aria-valuenow",n);n>=100?clearInterval(interval):n>=70&&(step=.1)},100)}function FinishProgress(){clearInterval(interval);$(".atlas-progress").find(".progress-bar").css("width","100%").attr("aria-valuenow","100");resetTimeout=setTimeout(function(){FinalProgress()},2e3)}function FinalProgress(){var n=$(".atlas-progress");typeof interval!="undefined"&&n.find(".progress-bar").attr("aria-valuenow")=="100"&&(clearInterval(interval),n.fadeOut().find(".progress-bar").css("transition","width 0s").css("width","0%").attr("aria-valuenow","0").show(),n.show().find(".progress-bar").css("transition","width .6s ease"))}function ResetProgress(){var n=$(".atlas-progress");typeof interval!="undefined"&&(clearInterval(interval),n.hide(),n.find(".progress-bar").css("transition","width 0s").css("width","0%").attr("aria-valuenow","0"),n.show(),n.find(".progress-bar").css("transition","width .6s ease"))}function abortAjax(){for(var n=ajaxPool.length;n--;)ajaxPool[n].abort(),ajaxPool.splice(n,1)}function loadPage(n,t){abortAjax();var i=new Date;ResetProgress();$(".tooltip").tooltip("hide");StartProgress();$.ajax({method:"get",url:n,error:function(){window.location=n},success:function(i){$("#AdColOne").html("");$("#AdColTwo").html("");CloseSearch(n);$("main").html(i);var r=i.match(/<title>(.*?)<\/title>/);document.title=r?r[1]:"Atlas of Information Management";(t===""||typeof t=="undefined")&&history.pushState({state:"ajax"},document.title,n)}}).done(function(){FinishProgress();postAnalytics((new Date).getTime()-i.getTime());lastState=window.location.href;lastTitle=document.title;currentPathname=document.location.pathname;document.location.hash!==""&&document.location.hash!==null&&$('.nav-links.tabs a[href="'+document.location.hash+'"]').tab("show");DynamicDropdownLoad();loadCheckbox();buildInputs();$(".resize-header").textfill();$(".report-title").textfill();$("#searchBox").val("");$('[data-toggle="tooltip"]').tooltip();tableSort();loadAjaxContent();hljs.initHighlighting.called=!1;hljs.initHighlighting()})}function tableSort(){$("table.sort th i.fa-sort").length||($("table.sort th").css("cursor","pointer").append('<i class="fas fa-sort ml-2"><\/i>').parent("tr").css("white-space","nowrap"),$("table.sort th").click(function(){var i=$(this).parents("table").eq(0),n=i.find("tr:gt(0)").toArray().sort(comparer($(this).index())),t;for(this.asc=!this.asc,this.asc||(n=n.reverse()),t=0;t<n.length;t++)i.append(n[t])}))}function comparer(n){return function(t,i){var r=getCellValue(t,n).replace("$",""),u=getCellValue(i,n).replace("$","");return/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(r)&&/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(u)?new Date(r)-new Date(u):$.isNumeric(r)&&$.isNumeric(u)?r-u:r.toString().localeCompare(u)}}function getCellValue(n,t){return $(n).children("td").eq(t).text()}function loadAjaxContent(){$('[data-ajax="yes"]').not('#AdColOne, #AdColTwo [data-ajax="yes"]').each(function(){$(this).hasClass("no-loader")||$(this).html('<div class="w-100 ajax-loader-wrapper"><img class="ajax-loader" src="/img/spinning_loader.gif" /><\/div>');var n=$(this),t=n.attr("data-url");n[0].hasAttribute("data-param")&&(t+=t.indexOf("?")!=-1?"&":"?",t+=n.attr("data-param"));n[0].hasAttribute("data-loadtag")&&(t+=" "+n.attr("data-loadtag"));n.load(t,function(){n.hide().show(100);DynamicDropdownLoad();loadCheckbox();buildInputs();tableSort()})})}function loadAdAjaxContent(){$('#AdColOne, #AdColTwo [data-ajax="yes"]').each(function(){$(this).hasClass("no-loader")||$(this).html('<div class="w-100 ajax-loader-wrapper"><img class="ajax-loader" src="/img/spinning_loader.gif" /><\/div>');var n=$(this),t=n.attr("data-url");n[0].hasAttribute("data-param")&&(t+=t.indexOf("?")!=-1?"&":"?",t+=n.attr("data-param"));n[0].hasAttribute("data-loadtag")&&(t+=" "+n.attr("data-loadtag"));n.load(t,function(){n.hide().show(100);DynamicDropdownLoad();loadCheckbox();buildInputs();tableSort()})})}function reloadFavs(){var n=$(".favorites-container").parent('[data-ajax="yes"]');n.length>0&&(n.hide().load(n.attr("data-url"),function(){n.show(100)}),buildInputs())}function showall(){var n=$(".show-all");$("#no-results").hide();n.siblings(".active").removeClass("active").find("i").removeClass("fa-folder-open").addClass("fa-folder");n.addClass("active").find("i").removeClass("fa-folder").addClass("fa-folder-open");$(".favorites div[folder-id]").show(75);$(".favorites div[folder-id]").length==0&&($("#no-results").children("form").hide(),$("#no-results").show(75))}function getHoveredFolder(n,t){for(var u=$("#favfolders .fav-filter,.show-all").removeClass("hover").toArray(),r=0;r<u.length;r++){var i=u[r],f=$(i).offset().top,e=$(i).offset().top+$(i).outerHeight(),o=$(i).offset().left,s=$(i).offset().left+$(i).outerWidth();if(t>f&&t<e&&n>o&&n<s)return $(i)}return!1}function UpdateReportRank(){var n=$(".favorites div[folder-id]").map(function(n){return item={},item.FavoriteId=$(this).attr("favorite-id"),item.FavoriteRank=n,item}).get();$.ajax({method:"post",url:"/Users?handler=ReorderFavorites",data:JSON.stringify(n),dataType:"json",contentType:"application/json; charset=utf-8"})}function UpdateFavoriteFolder(n,t){item={};item.FavoriteId=n;item.FolderId=t;$.ajax({method:"post",url:"/Users?handler=UpdateFavoriteFolder",data:JSON.stringify(item),dataType:"json",contentType:"application/json; charset=utf-8"})}function redorder(n,t,i){var r=getHoveredFolder(t,i),e=n.attr("folder-id"),u,f;r!==!1?(r.hasClass("show-all")?n.attr("folder-id","0"):n.attr("folder-id",r.attr("folder-id")),$("#favfolders .show-all").find("i.fa-folder-open").length==0&&(n.hide(75),$(".favorites div[folder-id][folder-id="+e+"]:visible").length<=0&&$("#no-results").show(75)),UpdateFavoriteFolder(n.attr("favorite-id"),n.attr("folder-id"))):(u=n.siblings(".favorites div[folder-id]:visible"),f=n.position().top,u.each(function(){var t=$(this).position(),i=t.top;if(f<i)return n.insertBefore($(this)),!1;n.insertAfter($(this))}),UpdateReportRank());n.css({"z-index":"",top:"",left:""})}function ReorderFolders(n){var t=n.siblings(".fav-filter"),i=n.position().top;t.each(function(){var t=$(this).position(),r=t.top;if(i<r)return n.insertBefore($(this)),!1;n.insertAfter($(this))});n.css({"z-index":"",top:"",left:""});UpdateRolderRank()}function UpdateRolderRank(){var n=$("#favfolders .fav-filter").map(function(n){return item={},item.FolderId=$(this).attr("folder-id"),item.FolderRank=n,item}).get();$.ajax({method:"post",url:"/Users?handler=ReorderFolders",data:JSON.stringify(n),dataType:"json",contentType:"application/json; charset=utf-8"})}function ShowMessageBox(n){$(".message-container .message-inner").text(n);$(".message-wrapper").removeClass("hidden").delay(2e3).queue(function(n){$(".message-wrapper").addClass("hidden");n()})}var timer,url,lastId,menuItems,scrollItems,myTop,hash,is_epic,current_progress,step,drag;buildInputs();$("body").on("focus",".input-wrapper > span",function(){$(this).parent().addClass("input-wrapper-focus-within")}).blur(function(){$(this).parent().removeClass("input-wrapper-focus-within")});$("body").on("input keypress paste change",".input-wrapper > span",function(){$(this).siblings("input, textarea").attr("value",$(this).text())});$("body").on("blur",".input-wrapper > span",function(){$(this).text($(this).text())});$(document).ready(function(){postAnalytics()});var searchAjax=null,lastState=null,lastTitle=null,loader='<img src="/img/loader.gif" style="margin-left:calc(50% - 75px / 2);width:75px; padding-top:50px" class="search"/>';lastState=window.location;lastTitle=document.title;$("body").on("click",".search-group",function(n){n.stopPropagation()});$("body").on("click",".search-history ul li a",function(n){var t,i;n.preventDefault();n.stopPropagation();$(".search-history").hide();t=$(this).attr("search");$(this).parents(".search-group").find("input").val($(this).find("span.searchString").text().trim());i=$(this).closest("search").length<1?$(this).closest("main"):$(this).closest("search");i.find("#results").html(loader);$("html, body").animate({scrollTop:0},"fast");searchAjax=$.ajax({method:"post",url:"/Search/Ajax",data:t,beforeSend:function(n){n.overrideMimeType("text/plain; charset=x-user-defined");searchAjax!==null&&searchAjax.abort()}}).done(function(n){i.html(n);$("main").find(".search").length>0?$('main[role="main"]').html(n).find("#close-search").remove():($(".search-results").html(n),$('main[role="main"]').addClass("main-hidden"),$(".search-results").removeClass("search-results-hidden"));history.pushState("",document.title,window.location.origin+"/Search?"+t)})});$("body").click(function(){$(".search-history").hide()});$(".search-group > input").focus(function(){$(this).parent().addClass("search-group-focus-within")}).blur(function(){$(this).parent().removeClass("search-group-focus-within")});$(".search-group > input").click(function(){$(".search-history").load("/Users?Handler=SearchHistory").show(100)});$(".search-group > input").tooltip({trigger:"manual"});$(".search-group > input").on("input",function(){$(this).val().length>=$(this).attr("maxlength")?$(this).tooltip("show"):$(this).tooltip("hide");AjaxSearch($(this).val())});$("body").on("click","#close-search",function(){$(".tooltip").tooltip("hide");CloseSearch(lastState.href);postAnalytics()});$("body").on("click",".filter .link",function(n){n.preventDefault();var t=$(this).closest("form"),i=t.find('input[name="f"]');i.val($(this).attr("value"));t.submit()});$("#searchCollapse").on("shown.bs.collapse",function(){$(".search-group input").focus()});$("#searchCollapse").on("hide.bs.collapse",function(n){n.target.id=="searchCollapse"&&($(".search-results").addClass("search-results-hidden").html(""),$('main[role="main"]').removeClass("main-hidden"),$(".search-group input").val(""),document.title=lastTitle)});$("body").on("click",".page-link",function(){var n=$(this).closest("form");$("<input>").attr({type:"hidden",value:$(this).attr("value"),name:$(this).attr("name")}).appendTo(n);n.submit()});$("body").on("submit","#searchForm, #searchPagination",function(n){n.preventDefault();var t=$(this).serialize(),i=$(this).closest("search").length<1?$(this).closest("main"):$(this).closest("search");i.find("#results").html(loader);$("html, body").animate({scrollTop:0},"fast");StartProgress();searchAjax=$.ajax({method:"post",url:"/Search/Ajax",data:t,beforeSend:function(n){n.overrideMimeType("text/plain; charset=x-user-defined");searchAjax!==null&&searchAjax.abort()}}).done(function(n){FinishProgress();i.html(n);$("main").find(".search").length>0?$('main[role="main"]').html(n).find("#close-search").remove():($(".search-results").html(n),$('main[role="main"]').addClass("main-hidden"),$(".search-results").removeClass("search-results-hidden"));history.pushState("",document.title,window.location.origin+"/Search?"+t)})});$(window).scroll(function(){$(".search-outer > input").blur()});$.fn.textfill=function(){return this.each(function(){$(this).find("span:first").text($(this).find("span:first").text().replace(/_/g," "));var n=$("span:first",this),i=$(this),e=i.height(),u=i.width(),t=parseInt(n.css("fontSize"),10),f=u/n.width(),r=t*(f-.05);n.css("fontSize",Math.min(r,t));r<t&&n.css("margin-top","auto")})};setCookie("alive","y");$(".resize-header").textfill();$(".report-title").textfill();$("#searchBox").val("");$("body").on("click",".pop",function(){$(".imagepreview").attr("src",$(this).find("img").attr("src"));$("#imagemodal").modal("show")});$("p.markdown").each(function(){$(this).html($(this).text().replace(/\[(.+?)\]\((.+?)\)/g,'<a href="$2" target="_blank">$1<\/a>'))});$(".approvedYnHiddenTextArea").val()==="Y"?$("#approvedYn").prop("checked",!0):$("#approvedYn").prop("checked",!1);$("#approvedYn").change(function(){$("#approvedYn").is(":checked")?$(".approvedYnHiddenTextArea").val("Y"):$(".approvedYnHiddenTextArea").val("N")});$(".ExecutiveVisibilityYnHiddenTextArea").val()==="Y"?$("#ExecutiveVisibilityYn").prop("checked",!0):$("#ExecutiveVisibilityYn").prop("checked",!1);$("#ExecutiveVisibilityYn").change(function(){$("#ExecutiveVisibilityYn").is(":checked")?$(".ExecutiveVisibilityYnHiddenTextArea").val("Y"):$(".ExecutiveVisibilityYnHiddenTextArea").val("N")});$("#Hidden").change(function(){$("#Hidden").is(":checked")?$(".HiddenReportHiddenTextArea").val("Y"):$(".HiddenReportHiddenTextArea").val("N")});$(".EnabledForHyperspaceHiddenTextArea").val()==="Y"?$("#EnabledForHyperspace").prop("checked",!0):$("#EnabledForHyperspace").prop("checked",!1);$("#EnabledForHyperspace").change(function(){console.log("changed");console.log($("#EnabledForHyperspace").is(":checked"));$("#EnabledForHyperspace").is(":checked")?$(".EnabledForHyperspaceHiddenTextArea").val("Y"):$(".EnabledForHyperspaceHiddenTextArea").val("N");console.log($(".EnabledForHyperspaceHiddenTextArea").val())});$(".DoNotPurgeHiddenTextArea").val()==="Y"?$("#DoNotPurge").prop("checked",!0):$("#DoNotPurge").prop("checked",!1);$("#DoNotPurge").change(function(){$("#DoNotPurge").is(":checked")?$(".DoNotPurgeHiddenTextArea").val("Y"):$(".DoNotPurgeHiddenTextArea").val("N")});$("body").on("change","#NewTermLink_TermId",function(){$.ajax({url:"/Reports?handler=CurrentTermDetails&TermId="+$(this).val(),method:"post",success:function(n){n&&($(".new-term-summary").html('<div class="markdown noleft">'+n.summary||"n/a<\/div>"),$(".new-term-def").html('<div class="markdown noleft">'+n.technicalDefinition||"n/a<\/div>"),hljs.initHighlighting.called=!1,hljs.initHighlighting())}})});$("#TermLookupSelect").trigger("change");$(window).scroll(function(){$(this).scrollTop()>50?$("#back-to-top").fadeIn():$("#back-to-top").fadeOut()});$("#back-to-top").click(function(){return $("body,html").animate({scrollTop:0},200),!1});$(function(){$('[data-toggle="tooltip"]').tooltip()});$("#browser-back").click(function(){history.back();$(this).blur()});$("#browser-forward").click(function(){history.forward();$(this).blur()});url=document.location.toString();url.match("#")&&$('.nav-links.tabs a[href="#'+url.split("#")[1]+'"]').tab("show");$("body").on("submit","form",function(){abortAjax()});var is_safari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),is_edge=navigator.userAgent.indexOf("Edge")>-1,is_explorer=typeof document!="undefined"&&!!document.documentMode&&!is_edge;$("body").on("click",'.nav-links a[href^="#"]',function(n){n.preventDefault();$('a[href^="#"].active').length<1&&$(this).addClass("active");$($.attr(this,"href")).get(0).scrollIntoView()});menuItems=$(".nav-links:not(.filter):not(.tabs)").find("a.link:not(.external)");scrollItems=menuItems.map(function(){var n=$($(this).attr("href"));if(n.length)return n});$(".heading-container").Count>0&&$(".heading-container").position().top>=123&&($(".heading-container").addClass("atlas-sticky"),$("section").first().addClass("atlas-sticky"));myTop=typeof specialTop=="undefined"?123:specialTop;hash=window.location.hash;menuItems.removeClass("active").filter("[href='"+hash+"']").addClass("active");$(window).scroll(function(){var i,n,t;if($(this).scrollTop()<=myTop?($(".heading-container").removeClass("atlas-sticky"),$("section").first().removeClass("atlas-sticky")):($(".heading-container").addClass("atlas-sticky"),$("section").first().addClass("atlas-sticky")),$(this).scrollTop()<70){lastId="";return}i=$(this).scrollTop()+30;n=scrollItems.map(function(){if($(this).offset().top<i)return this});n=n[n.length-1];t=n&&n.length?n[0].id:"";lastId!==t&&(lastId=t,menuItems.removeClass("active").filter("[href='#"+t+"']").addClass("active"))});$(".comment-wrapper > .new-comment-contenteditable").on("focus",function(){$(this).parent().addClass("comment-wrapper-focus-within")}).blur(function(){$(this).parent().removeClass("comment-wrapper-focus-within")});$("body").on("submit",".ajax-comment-form",function(n){n.preventDefault();$.ajax({method:"post",url:$(this).attr("action"),data:$(this).serialize(),error:function(n){console.log(n)},success:function(n){$(".ajax-comment-box").fadeOut(50).html(n).fadeIn(50)}})});$("body").on("input",".new-comment-contenteditable",function(){$(this).closest("form").find("textarea").text($(this).text())});buildHtml=function(){var n=$(':input[type="dynamic-dropdown"]');n.each(function(n){var t=$(this),i;hiddenInput=document.createElement(t.get(0).tagName);$(hiddenInput).addClass(t.attr("class"));$(hiddenInput).attr("id",t.attr("id"));$(hiddenInput).attr("name",t.attr("name"));$(hiddenInput).css("display","none");$(hiddenInput).attr("dname","dropdown"+n);$(hiddenInput).attr("tabindex","-1");$(hiddenInput).attr("value",t.attr("value"));$(hiddenInput).attr("multiple","true");visibleInput=document.createElement("input");$(visibleInput).addClass("dynamic-dropdown-input");$(visibleInput).attr("search-area",t.attr("search-area"));$(visibleInput).attr("dname","dropdown"+n);$(visibleInput).attr("autocomplete","off");$(visibleInput).attr("placeholder",t.attr("placeholder")||"type to search..");$(visibleInput).attr("data-placeholder",t.attr("placeholder")||"type to search..");$(visibleInput).attr("value",t.attr("visible-value"));$(visibleInput).attr("required",t.attr("required"));$(visibleInput).attr("method",t.attr("method"));dropdownResults=document.createElement("div");$(dropdownResults).addClass("dynamic-dropdown-results").css("display","none");dynamicDropdown=document.createElement("div");$(dynamicDropdown).addClass(t.attr("class")).addClass("dynamic-dropdown").attr("data-head",t.attr("data-head")).html(hiddenInput);i=t.find("option");i.each(function(){$(hiddenInput).append($(this));span=document.createElement("span");$(span).text($(this).text());$(dynamicDropdown).append(span)});$(dynamicDropdown).append(visibleInput).append(dropdownResults);html=document.createElement("div");$(html).addClass("dynamic-dropdown-container").html(dynamicDropdown);t.replaceWith($(html))})};validate=function(n){n.siblings("input:not(visible)").length>0&&(n.val().length>0&&n.siblings("input:not(visible)").attr("value").length<1?n.parent().removeClass("valid").addClass("invalid"):n.parent().removeClass("invalid").addClass("valid"))};blurOthers=function(n){n||(n="");var t=$(".dynamic-dropdown").not(n);t.each(function(){blurThis($(this))})};blurThis=function(n){var i=n,t=n.find("input:visible"),r=n.find(".dynamic-dropdown-results");i.removeClass("show");i.removeClass("dynamic-dropdown-focus-within");i.find(".dynamic-dropdown-results:visible").hide();i.find(".dynamic-dropdown-result-item").removeClass("active");r.before(t);t.val()===""&&t.siblings("span").length===0&&t.attr("placeholder",t.attr("data-placeholder"));setWidth(t);validate(t)};focusThis=function(n,t){var f,e;blurOthers(n);n.addClass("dynamic-dropdown-focus-within").addClass("show");t||(t=99999);var r=n.find("span"),i=n.find("input:visible"),u=i.offset().left;i.attr("placeholder","").width(4);f=t.pageX;r.length>0&&r.each(function(){var n=$(this),t=$(this).offset().left;f<t+n.width()/2?u>t+n.width()/2&&(i.insertBefore(n).focus(),u=t):i.insertAfter(n).focus()});i.siblings(".dynamic-dropdown-results").children().length>0&&i.siblings(".dynamic-dropdown-results").show();t.target.nodeName!="INPUT"&&(e=i.val(),i.focus().val("").val(e));setWidth(i);t.stopPropagation()};setWidth=function(n){var t=$('<div class="text-width"><\/div>').text(n.val());$("body").append(t);n.next("span").length===0&&n.val()===""&&t.text(n.attr("placeholder"));n.width(Math.max(t.width()+2,4));t.remove()};addItem=function(n,t){var i,u,f,r;t=="exit"?(i=n,u=n.siblings('*[dname="'+i.attr("dname")+'"]'),f=u.get(0).tagName,r=n.siblings(".dynamic-dropdown-results").find(".dynamic-dropdown-result-item.active").first().length?n.siblings(".dynamic-dropdown-results").find(".dynamic-dropdown-result-item.active").first():n.siblings(".dynamic-dropdown-results").find('.dynamic-dropdown-result-item:visible:not(:contains("No matches found"))').first(),r=r,f=="SELECT"?r.length>0&&r.attr("value").length>0?(i.val("").before("<span>"+r.text()+"<\/span>").focus(),u.append('<option selected="selected" value="'+r.attr("value")+'">'+r.text()+"<\/option>").change(),r.addClass("hidden"),i.siblings(".dynamic-dropdown-results").find(".dynamic-dropdown-result-item:not(.hidden)").length===0&&i.siblings(".dynamic-dropdown-results").append('<div class="dynamic-dropdown-result-item no-results" value="">No matches found<\/div>')):i.val(""):(n.val(r.text()),n.trigger("change"),u.attr("value",r.attr("value")).change(),i.attr("method")!=="fullList"&&i.siblings(".dynamic-dropdown-results").html('<div class="dynamic-dropdown-result-item no-results" value="">No matches found<\/div>')),blurThis(i.parent())):t=="click"&&(i=n.parent(".dynamic-dropdown-results").siblings(".dynamic-dropdown-input"),u=i.siblings('*[dname="'+i.attr("dname")+'"]'),f=u.get(0).tagName,r=n,f=="SELECT"?(i.val("").before("<span>"+r.text()+"<\/span>").focus(),u.append('<option selected="selected" value="'+r.attr("value")+'">'+r.text()+"<\/option>").change(),r.addClass("hidden"),i.siblings(".dynamic-dropdown-results").find(".dynamic-dropdown-result-item:not(.hidden)").length===0&&i.siblings(".dynamic-dropdown-results").append('<div class="dynamic-dropdown-result-item no-results" value="">No matches found<\/div>')):(u.attr("value",r.attr("value")).change(),i.val(r.text()),i.trigger("change"),blurThis(i.parent()),i.attr("method")!=="fullList"&&i.siblings(".dynamic-dropdown-results").html('<div class="dynamic-dropdown-result-item no-results" value="">No matches found<\/div>')));setWidth(i)};loadGetList=function(){var n=$(':input[class="dynamic-dropdown-input"]:not(.rendered)[method="fullList"]');console.log(n);n.each(function(){var n=$(this),t;console.log(n);n.addClass("rendered");t=n.siblings("select").children("option").map(function(){return this.value});$.ajax({method:"post",url:"/Search?handler=ValueList",data:{s:$(this).attr("search-area")},beforeSend:function(n){n.overrideMimeType("text/plain; charset=x-user-defined")}}).always(function(i){var f="",r,u,e;if(i=JSON.parse(i),i.length===0)n.siblings(".dynamic-dropdown-results").html('<div class="dynamic-dropdown-result-item disabled">No values found<\/div>');else for(r=0;r<i.length;r++)u="",$.inArray(String(i[r].ObjectId),t)!=-1&&(u="hidden"),e=i[r].ObjectId||i[r].Description,f+='<div class="dynamic-dropdown-result-item '+u+'" value="'+e+'">'+i[r].Name+"<\/div>",r==i.length-1&&n.siblings(".dynamic-dropdown-results").html(f),n.siblings(".dynamic-dropdown-results").find(".dynamic-dropdown-result-item:not(.hidden)").length===0&&n.siblings(".dynamic-dropdown-results").append('<div class="dynamic-dropdown-result-item no-results" value="">No matches found<\/div>')})})};$(document).ready(function(){DynamicDropdownLoad();$("body").on("click",".dynamic-dropdown",function(n){focusThis($(this),n)});$("body").on("keydown",".dynamic-dropdown-input",function(n){var i,t;n.keyCode==8&&$(this).val().length===0?(i=$(this).siblings("select[dname]").find(":contains("+$(this).prev("span").text()+")").attr("value"),$(this).siblings(".dynamic-dropdown-results").find('.dynamic-dropdown-result-item.hidden[value="'+i+'"]').removeClass("hidden"),$(this).siblings(".dynamic-dropdown-results").find(".dynamic-dropdown-result-item:not(.hidden)").length!==0&&$(this).siblings(".dynamic-dropdown-results").find(".dynamic-dropdown-result-item.no-results").remove(),$(this).siblings("*[dname]").find(":contains("+$(this).prev("span").text()+")").remove(),$(this).prev("span").remove(),$(this).find("span").length===0&&$(this).val().length===0&&($(this).attr("placeholder",$(this).attr("data-placeholder")),setWidth($(this)))):n.keyCode==37?($(this).prev("span").length>0&&($(this).attr("placeholder",""),setWidth($(this))),$(this).insertBefore($(this).prev("span")).focus()):n.keyCode==39?$(this).insertAfter($(this).next("span")).focus():n.keyCode==46?(i=$(this).siblings("select[dname]").find(":contains("+$(this).prev("span").text()+")").attr("value"),$(this).siblings(".dynamic-dropdown-results").find('.dynamic-dropdown-result-item.hidden[value="'+i+'"]').removeClass("hidden"),$(this).siblings(".dynamic-dropdown-results").find(".dynamic-dropdown-result-item:not(.hidden)").length!==0&&$(this).siblings(".dynamic-dropdown-results").find(".dynamic-dropdown-result-item.no-results").remove(),$(this).siblings("*[dname]").find(":contains("+$(this).next("span").text()+")").remove(),$(this).next("span").remove()):n.keyCode==13||n.keyCode==3?(n.preventDefault(),addItem($(this),"exit"),$(this).focus()):n.keyCode==9?(n.preventDefault(),blurOthers(),t=$(this).closest("form").find(":input:visible"),n.shiftKey?(t.eq(t.index(this)-1).focus(),t.eq(t.index(this)-1).hasClass("dynamic-dropdown-input")&&focusThis(t.eq(t.index(this)-1).parent(),n)):(t.eq(t.index(this)+1).focus(),t.eq(t.index(this)+1).hasClass("dynamic-dropdown-input")&&focusThis(t.eq(t.index(this)+1).parent(),n))):n.keyCode==38?(n.preventDefault(),$(this).siblings(".dynamic-dropdown-results").find(".dynamic-dropdown-result-item.active").length>0&&($(this).siblings(".dynamic-dropdown-results").find(".dynamic-dropdown-result-item").first().hasClass("active")?$(this).siblings(".dynamic-dropdown-results").find(".dynamic-dropdown-result-item.active").removeClass("active"):$(this).siblings(".dynamic-dropdown-results").find(".dynamic-dropdown-result-item.active").removeClass("active").prevAll(".dynamic-dropdown-result-item:visible:first").addClass("active"))):n.keyCode==40&&(n.preventDefault(),$(this).siblings(".dynamic-dropdown-results").find(".dynamic-dropdown-result-item.active").length>0?$(this).siblings(".dynamic-dropdown-results").find(".dynamic-dropdown-result-item").last().hasClass("active")||$(this).siblings(".dynamic-dropdown-results").find(".dynamic-dropdown-result-item.active").removeClass("active").nextAll(".dynamic-dropdown-result-item:visible:first").addClass("active"):$(this).siblings(".dynamic-dropdown-results").show().find(".dynamic-dropdown-result-item:visible").first().addClass("active"))});$("body").on("input",".dynamic-dropdown-input",function(){var t=$(this).val(),i;if($(this).closest("form").find('input[dname="'+$(this).attr("dname")+'"]').attr("value",""),setWidth($(this)),$(this).attr("method")=="fullList")i=$(this).siblings(".dynamic-dropdown-results").show().find(".dynamic-dropdown-result-item"),t.length===0?i.show():i.each(function(){$(this).text().toUpperCase().indexOf(t.toUpperCase())>=0?$(this).show():$(this).hide()});else{var n=$(this),r=$(this).parent(),f=$(this).attr("dname"),u="",e=$(this).attr("search-area"),o=n.siblings("select[dname]").children("option"),s=$.map(o,function(n){return n.value});t.length>0?searchAjax=$.ajax({method:"post",url:"/Search?handler="+e,data:{s:t,e:s.toString()},beforeSend:function(n){n.overrideMimeType("text/plain; charset=x-user-defined");searchAjax!==null&&searchAjax.abort()}}).done(function(t){var i,f;if(t=JSON.parse(t),r.addClass("show"),t.length===0)n.siblings(".dynamic-dropdown-results").html('<div class="dynamic-dropdown-result-item disabled">No matches found<\/div>').show();else for(i=0;i<t.length;i++)f=t[i].ObjectId||t[i].Description,u+='<div class="dynamic-dropdown-result-item" value="'+f+'">'+t[i].Name+"<\/div>",i==t.length-1&&n.siblings(".dynamic-dropdown-results").html(u),n.siblings(".dynamic-dropdown-results").show()}):(n.siblings(".dynamic-dropdown-results").hide(),r.removeClass("show"),n.closest("form").find('input[dname="'+f+'"]').attr("value",""))}});$("body").on("click",".dynamic-dropdown-result-item",function(){addItem($(this),"click")});$("body").on("click",".dynamic-dropdown-input",function(n){focusThis($(this).parent(),n);n.stopPropagation()});$(document).click(function(){blurOthers()});$("body").on("click",".dynamic-dropdown-results",function(n){n.stopPropagation()})});$(".list-input-input").each(function(){setWidth($(this))});$(".list-input-input").on("input",function(){setWidth($(this))});loadCheckbox();$("body").on("click",".checkbox-container",function(n){if(n.target.tagName=="INPUT"){var t=$(this).closest("form").find("select").find('option[value="'+$(this).attr("check-id")+'"]');t.attr("selected")?t.removeAttr("selected"):t.attr("selected","selected")}});$("body").on("click",".checkbox-container.role-permissions",function(n){if(n.target.tagName=="INPUT"){var r=$(this).attr("roleid"),u=$(this).attr("permissionid"),t=$(this).find("input"),f=t.attr("checked"),i=1;f==="checked"?(t.removeAttr("checked"),i=2):t.attr("checked","checked");$.ajax({method:"post",url:"/AccessControl?handler=UpdatePermissions",data:{RoleId:r,PermissionId:u,Type:i},beforeSend:function(n){n.overrideMimeType("text/plain; charset=x-user-defined")}}).done(function(n){n==="success"&&ShowMessageBox("Changes saved.")})}});$("body").on("click",".favorite-search:not(.disabled) > i, .favorite:not(.disabled)",function(n){n.preventDefault();n.stopPropagation();var u=$(this).parents(".favorites-container").length,t=1,i=$(this).attr("favorite-type"),r=$(this).attr("object-id"),f=$(this).attr("object-name");$('[favorite-type="'+i+'"][object-id="'+r+'"]').each(function(){$(this).hasClass("no")?$(this).removeClass("no").addClass("yes"):($(this).removeClass("yes").addClass("no"),t=0)});$(this).parents(".favorites").length>0&&($(".favorites div[folder-id]:visible").length<=1&&$("#no-results").show(75),$(this).parents(".result").hide(50).remove());$.ajax({method:"post",url:"/users?handler=EditFavorites",data:{actionType:t,favoriteType:i,objectId:r,objectName:f}}).done(function(){u<1&&reloadFavs()})});$("html").css("visibility","visible");$("body").on("click",".request-access",function(){$.ajax({method:"POST",url:"/Requests?handler=AccessRequest",data:{reportName:$(this).attr("report-name"),directorName:$("#director-name").val(),reportUrl:window.location.href}}).done(function(){ShowMessageBox("Your request has been submitted.")});$("#requestAccessModal").modal("hide")});$("body").on("click",".report-problem",function(){$.ajax({method:"POST",url:"/Requests?handler=ReportProblem",data:{reportName:$(this).attr("report-name"),description:$(this).parent("div").siblings(".modal-body").find("textarea").val(),reportUrl:window.location.href}}).done(function(){ShowMessageBox("Your problem has been submitted.")});$("#reportProblem").modal("hide")});is_epic=getUrlVars().EPIC;(is_epic==1||getCookie("EPIC")==1)&&setCookie("EPIC",1,99);current_progress=0;step=.5;ajaxPool=[];$.ajaxSetup({beforeSend:function(n){ajaxPool.push(n)}});$("body").on("click",".ajax",function(n){n.preventDefault();$(".modal").modal("hide");var t=$(this).attr("href");/^#/.test(t)?($('.nav-links.tabs a[href="'+document.location.hash+'"]').tab("show"),history.pushState({state:"ajax"},document.title,window.location.href.split("#")[0]+t)):loadPage(t)});currentPathname=null;window.onpopstate=function(n){if(document.location.pathname==currentPathname)return document.location.hash?$('.nav-links.tabs a[href="'+document.location.hash+'"]').tab("show"):$(".nav-links.tabs a[href]:first").tab("show"),!1;currentPathname=document.location.pathname;n.state!==null&&n.state.state=="ajax"?loadPage(document.location,"replace"):window.location.href=document.location.href};tableSort();loadAjaxContent();loadAdAjaxContent();$("body").on("click",".fav-filter",function(){$("#no-results").hide();$(this).hasClass("active")?($(this).removeClass("active").find("i").removeClass("fa-folder-open").addClass("fa-folder"),$(".favorites div[folder-id]").show(75),$(this).siblings(".show-all").addClass("active").find("i").removeClass("fa-folder").addClass("fa-folder-open")):($(this).parent().find(".active").removeClass("active").find("i").removeClass("fa-folder-open").addClass("fa-folder"),$(".favorites div[folder-id][folder-id!="+$(this).attr("folder-id")+"]").hide(75),$(".favorites div[folder-id][folder-id="+$(this).attr("folder-id")+"]").show(75),$(this).addClass("active").find("i").removeClass("fa-folder").addClass("fa-folder-open"),$(".favorites div[folder-id][folder-id="+$(this).attr("folder-id")+"]").length==0&&($("#no-results").show(75).children().show(),$("#Folder_UserFavoriteFolderId").val($(this).attr("folder-id"))))});$("body").on("click",".show-all",function(){showall()});$("body").on("submit","#CreateFolderForm",function(n){n.preventDefault();var t=$(this).find("input:first"),i=t.val(),r=$(this).find("span");$.ajax({method:"post",url:$(this).attr("action"),data:$(this).serialize(),error:function(n){console.log(n)},success:function(n){$("#favfolders").children("div.btn").last().before('<div class="btn btn-light w-100 text-left fav-filter" style="overflow:hidden;text-overflow: ellipsis;" folder-id="'+n+'"><i class="fas fa-folder mr-3"><\/i>'+i+'<div class="folder-grip float-right text-secondary" style="cursor: move; display: none;"><i class="fas fa-grip-lines fa-folder"><\/i><\/div><\/div>');r.text("");$("#newfolder").collapse("hide")}}).done(function(){})});$("body").on("submit","#DeleteFolderForm",function(n){n.preventDefault();var t=$(this).find("#Folder_UserFavoriteFolderId").val();$.ajax({method:"post",url:$(this).attr("action"),data:$(this).serialize(),error:function(){},success:function(){$("#favfolders").find("div[folder-id][folder-id='"+t+"']").remove();showall()}})});drag=!1;$("body").on("mousedown",".favorites:not(.disabled) div[folder-id]",function(n){if($(n.target).hasClass("search-detail-collapse")||$(n.target).hasClass("atlas-blue")||$(n.target).hasClass("fa-star"))return i=!1,!1;var i=!0,t=$(this).addClass("draggable"),f=t.css("z-index"),r=t.outerHeight(),u=t.outerWidth(),e=t.offset().top+r-n.pageY,o=t.offset().left+u-n.pageX;t.css("z-index",1e3).css("opacity",.7).parents().on("mousemove",function(n){$(".draggable").offset({top:n.pageY+e-r,left:n.pageX+o-u}).on("mouseup",function(){$(this).removeClass("draggable").css("z-index",f);i=!1});if(i==!0){var t=getHoveredFolder(n.pageX,n.pageY);t!==!1&&t.addClass("hover")}});n.preventDefault()});$("body").on("mouseup",".favorites div[folder-id]",function(n){if(t=!1,$(n.target).hasClass("search-detail-collapse")||$(n.target).hasClass("atlas-blue")||$(n.target).hasClass("fa-star"))return!1;$(this).css("opacity",1);redorder($(this),n.pageX,n.pageY);$(this).removeClass("draggable");var t=!1});$("body").on("mouseenter",".fav-filter",function(){$(this).find(".folder-grip").show(100)});$("body").on("mouseleave",".fav-filter",function(){$(this).find(".folder-grip").hide(100)});$("body").on("mousedown","#favfolders .fav-filter .folder-grip",function(n){var t=$(this).addClass("active-handle").parent().addClass("draggable"),u=t.css("z-index"),i=t.outerHeight(),r=t.outerWidth(),f=t.offset().top+i-n.pageY,e=t.offset().left+r-n.pageX;t.css("z-index",1e3).css("opacity",.7).parents().on("mousemove",function(n){$(".draggable").offset({top:n.pageY+f-i,left:n.pageX+e-r}).on("mouseup",function(){$(this).removeClass("draggable").css("z-index",u);drag=!1});if(drag==!0){var t=getHoveredFolder(n.pageX,n.pageY);t!==!1&&t.addClass("hover")}});n.preventDefault()});$("body").on("mouseup","#favfolders .fav-filter .folder-grip",function(n){n.preventDefault();$(this).parent().css("opacity",1);ReorderFolders($(this).parent(),n.pageX,n.pageY);$(this).removeClass("active-handle").parent().removeClass("draggable")});$("body").on("click",".ad-video-inner-wrapper, .ad-video-wrapper button.video-open",function(n){$(this).parents(".ad-video-wrapper").removeClass("ad-closed").addClass("ad-large");document.getElementsByTagName("video")[0].play();n.stopPropagation()});$("body").on("click",".ad-video-wrapper button.video-minimize",function(n){$(this).parents(".ad-video-wrapper").removeClass("ad-large").removeClass("ad-closed");document.getElementsByTagName("video")[0].play();n.stopPropagation();$.ajax({method:"POST",url:"/Users?handler=WelcomeToAtlasState",data:{State:1}}).done(function(n){console.log(n)})});$("body").on("click",".ad-video-wrapper button.video-close",function(n){$(this).parents(".ad-video-wrapper").removeClass("ad-large").addClass("ad-closed");document.getElementsByTagName("video")[0].pause();n.stopPropagation();$.ajax({method:"POST",url:"/Users?handler=WelcomeToAtlasState",data:{State:0}}).done(function(n){console.log(n)})});$("body").on("click",".ad-video-wrapper",function(){$(".ad-video-wrapper").hasClass("ad-closed")&&($(".ad-video-wrapper").removeClass("ad-closed"),document.getElementsByTagName("video")[0].play(),$.ajax({method:"POST",url:"/Users?handler=WelcomeToAtlasState",data:{State:1}}).done(function(n){console.log(n)}))});$("body").click(function(){$(".ad-video-wrapper").hasClass("ad-large")&&$(".ad-video-wrapper").removeClass("ad-large")});$("body").on("click",".message-wrapper .message-close",function(){$(".message-wrapper").addClass("hidden")});$("body").on("click",".checkbox-container.milestone-checklist",function(n){if(n.target.tagName=="INPUT"){var i=$(this).closest("form"),t=$(this).find("input"),r=t.attr("checked"),u=1;r==="checked"?(t.removeAttr("checked"),u=2):t.attr("checked","checked");$.ajax({method:"post",url:i.attr("action"),data:i.serialize()}).done(function(n){n==="success"&&ShowMessageBox("Changes saved.")})}});