@page
@inject IConfiguration Configuration

@model Atlas_Web.Pages.Search.IndexModel
@{ ViewData["Title"] = "Search " + Model.SearchString;

@if (HttpContext.Request.Headers["x-requested-with"] == "XMLHttpRequest")
{
    Layout = null;
}
else
{
    Layout = "../Shared/_Layout.cshtml";
} }

@{ // url w/out page #
    //IEnumerable<dynamic> favs = ViewBag.Favorites;
    //var searchUrl = "s=" + Model.SearchString + "&f=" + Model.SearchFilter;
    //var searchFavorite = favs.Any(x => x.ItemType.ToLower().Equals("search") && x.ItemName.Equals(searchUrl));

    }

<div class="columns">

    <div class="column is-one-quarter sticky is-align-self-flex-start" style="max-height:calc(100vh - 137px); overflow-Y:auto">
        <partial name="Partials/_Filters" />
    </div>
    <div class="column" id="results">

        @if (Model.SearchResults != null && Model.SearchResults.NumFound > 0)
        {
            <div class="columns is-multiline">

                @foreach (var record in Model.SearchResults.Results)
                {
                    if (record.collection != null)
                    {
                        <div class="column is-full collection">
                            <partial name="Collections/_Snippet" model="record.collection" />
                        </div>
                    }
                    if (record.initiative != null)
                    {
                        <div class="column is-full initiative">
                            <partial name="Initiatives/_Snippet" model="record.initiative" />
                        </div>
                    }
                    if (record.report != null)
                    {
                        <div class="column is-full report">
                            <partial name="Reports/_Snippet" model="record.report" />
                        </div>
                    }
                    if (record.term != null)
                    {
                        <div class="column is-full term">
                            <partial name="Terms/_Snippet" model="record.term" />
                        </div>
                    }
                    if (record.user != null)
                    {
                        <div class="column is-full user">
                            <partial name="Users/_Snippet" model="record.user" />
                        </div>
                    }
                    if (record.group != null)
                    {
                        <div class="column is-full group">
                            <partial name="Groups/_Snippet" model="record.group" />
                        </div>
                    }

                }
            </div>

            <partial name="Partials/_Pagination" />
        }
        else
        {
            <div class="srch-none">
                <h5>Not finding what you are looking for?<br><a href="http://reports.riversidehealthcare.net/" target="_blank">Request a New Report here.</a></h5>
                <p>
                    <hr />
                    A few things to consider -<br><br>
                    Are you searching for a private or hidden report? Try out the advanced search filters!<br><br>
                    Is it a new Hyperspace Report? Hyperspace reports typically are not imported until the following business day.<br>
                    Is it a new SSRS Report? SSRS reports typically take two hours to be loaded into the search results.
                </p>
            </div>
        }
    </div>
    <!-- run modals -->
    @*
    @if (Model.SearchResults != null && Model.SearchResults.NumFound > 0)
    {

    @foreach (var record in Model.SearchResults.Results){
  var result = record.Result;
    @if (result.Type.First() == "reports" && record.AttachedFiles.Count() > 0){
    <div class="mdl" id="runModal-@result.AtlasId.First()" tabindex="-1">
        <div class="mdl-d mdl-wide">
            <div class="mdl-c">
                <div class="mdl-h">
                    <button type="button" class="close" data-dismiss="mdl">&times;</button>
                    <h2>Run This Report</h2>
                </div>
                <div class="mdl-b content">
                    <p>
                        This is a Crystal Report. Here are the recent run outputs.

                        <ul>
                            @foreach (var r in record.AttachedFiles)
                                                    {
                                                        var url = Helpers.HtmlHelpers.IsEpic(HttpContext) ? "EpicAct:AC_RW_WEB_BROWSER,LaunchOptions:2,runparams:" + HttpContext.Request.Scheme + "://" + HttpContext.Request.Host.Value+"/Data/File?handler=CrystalRun&id="+r.ReportObjectAttachmentId+"|FormCaption="+r.Name+"|ActivityName="+result.Name : "/Data/File?handler=CrystalRun&id="+r.ReportObjectAttachmentId;
                            <li><a href="@url" target="_blank">@r.Name</a><span> Â·  @r.CreationDate</span></li>
}
                        </ul>
                    </p>
                    <p>
                        If you need a <strong>newer</strong> dataset request a new run from the Report Library.
                        <ol>
                            <li>Open the Report Library</li>
                            <li>Search for this report</li>
                            <li>Click "view" > click "Request"</li>
                        </ol>
                    </p>
                    <p>
                        ~ after 5 minutes ~
                        <ol>
                            <li>Open My Reports</li>
                            <li>In the lower section of the screen you will find the report listed</li>
                            <li>Click "View Output"</li>
                        </ol>
                    </p>
                </div>
            </div>
        </div>
    </div>
    }
}
    }*@
</div>
