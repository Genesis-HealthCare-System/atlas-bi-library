@using Helpers
<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="/css/theme.min.css" />

    <link rel="preload" href="/js/main.min.js" as="script" />
    <link rel="preload" href="/js/search.min.js" as="script" />

    @inject IConfiguration Configuration

    @RenderSection("css", required: false)
    @RenderSection("startJs", required: false)


    @if (ViewData["Title"] != null && ViewData["Title"].ToString().Length > 0)
    {
    <title>@ViewData["Title"] | Atlas BI Library</title>
    }
    else
    {
    <title>Home | Atlas BI Library</title>
    }

    <link rel="preload" href="/font/fontawesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin />
    <link rel="preload" href="/font/fontawesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin />
    <link rel="preload" href="/font/inter/files/inter-latin-500-normal.woff2" as="font" type="font/woff2" crossorigin />
</head>
<body>
    <!-- site message -->
    @if (@ViewData["SiteMessage"] != null && @ViewData["SiteMessage"].ToString() != "")
    {
    <div class="site-message">
        <img src="/img/wave.png" class="site-messageImg" />
        <p class="site-messageText">
            @Html.Raw(HtmlHelpers.MarkdownToHtml(@ViewData["SiteMessage"].ToString()))
        </p>
        <button class="site-messageClose"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512"><path d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z" /></svg></button>
    </div>
    }
    @if (@Configuration["banner_text:site_message"] != null && @Configuration["banner_text:site_message"].ToString() != "")
    {
        <div class="notification is-light is-link has-text-centered my-0">
            @Html.Raw(HtmlHelpers.MarkdownToHtml(@Configuration["banner_text:site_message"]))
        </div>
    }
    <nav class="navbar is-transparent atlas-navbar has-shadow">
        <div class="container">
            <div class="navbar-brand">
                <a href="/">
                    <img src="/img/atlas-logo.png" width="162" height="50" />
                </a>
                <a role="button"
                   class="navbar-burger"
                   aria-label="menu"
                   aria-expanded="false"
                   data-target="atlas-main-nav">
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                </a>
            </div>
            <div class="navbar-start is-flex is-flex-grow-1 is-align-items-center px-3 pt-5"><!-- search --></div>
            <div class="navbar-menu is-flex-grow-0" id="atlas-main-nav">
                <div class="navbar-end">
                    @{ var r = new Random();
                                    var randomNumber = r.Next(); }
                    <a class="navbar-item" href="/?@randomNumber#mail">
                        <span class="icon is-medium is-relative">
                            <i class="far fa-lg fa-envelope"></i>
                            <span title="mail count" class="badge" id="nav_unread_message_count">0</span>
                        </span>
                        <span class="hide-desktop">Mail</span>
                    </a>

                    @if (@Model.Permissions.Contains(1) || Model.Permissions.Contains(18) || Model.Permissions.Contains(33) || Model.Permissions.Contains(34))
                    {
                    <div class="navbar-item has-dropdown is-hoverable is-boxed">
                        <div class="navbar-link is-arrowless">
                            <span class="icon is-medium">
                                <i class="fas fa-lg fa-wrench"></i>
                            </span>
                            <span class="hide-desktop">Administrative</span>
                        </div>
                        <div class="navbar-dropdown">
                            <hr class="hide-desktop dropdown-divider">
                            @if (Model.Permissions.Contains(18) || Model.Permissions.Contains(1))
                                {
                            <a class="navbar-item" href="/accesscontrol">Access Control</a>
                                }
                            @if (Model.Permissions.Contains(33) || Model.Permissions.Contains(34))
                                {
                            <a class="navbar-item" href="/parameters">Parameters</a>
                                }
                            @if (Model.Permissions.Contains(36))
                                {
                            <a class="navbar-item" href="/analytics">Analytics</a>
                                }
                            <a class="navbar-item" href="/tasks">Tasks</a>
                        </div>
                    </div>
                    }

                    <!-- main report groups -->
                    <div class="navbar-item has-dropdown is-hoverable is-boxed">
                        <div class="navbar-link is-arrowless">
                            <span class="icon is-medium">
                                <i class="fas fa-lg fa-list-ul"></i>
                            </span>
                            <span class="hide-desktop">Sections</span>
                        </div>
                        <div class="navbar-dropdown">
                            <hr class=" hide-desktop dropdown-divider">
                            <a class="navbar-item" href="/initiatives">Initiatives</a>
                            <a class="navbar-item" href="/collections">Collections</a>
                            <a class="navbar-item" href="/terms">Terms</a>
                            <hr class="dropdown-divider">
                            <a class="navbar-item" href="/about_analytics">About Analytics</a>
                        </div>
                    </div>
                    <a class="navbar-item" href="/users}" data-tooltip="Open Profile">
                        <span class="icon is-medium">
                            <i class="fas fa-lg fa-user"></i>
                        </span>
                        <span class="hide-desktop">Profile</span>
                    </a>

                    @if (Model.Permissions.Contains(44))
                    {
                        <div class="navbar-item has-dropdown is-hoverable is-boxed">
                            <div class="navbar-link">
                                @{ var ph = "";
                                        if (ViewBag.MyRole != null && ViewBag.MyRole.Name != null && ViewBag.MyRole.Name != "")
                                        {
                                            ph = ViewBag.MyRole.Name;
                                        }
                                        else
                                        {
                                            ph = "change role";
                                        } }
                                @ph
                            </div>
                            <div class="navbar-dropdown" id="role-change">
                                <hr class=" hide-desktop dropdown-divider">
                            </div>
                        </div>

                        <script>
                            q = new XMLHttpRequest();
                            q.open('post', '/Search?handler=ValueList&s=user-roles', true);
                            q.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
                            q.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
                            q.send();
                            q.onload = function () {
                                var data = JSON.parse(q.responseText);
                                var el = document.getElementById('role-change');
                                for (var x in data) {
                                    el.innerHTML += "<a class='navbar-item' href='/Users?handler=ChangeRole&Id=" + data[x].ObjectId + "&Url=" + window.location.href.replace(window.location.origin, '') + "'>" + data[x].Name + "</a>";
                                }
                            };
                        </script>
                    }

                    <!-- epic navigation -->
                    @if (Helpers.HtmlHelpers.IsEpic(Context) == true)
                    {
                    <a class="nav-link" onclick="history.back()">
                        <span class="icon">
                            <i class="fas fa-chevron-left"></i>
                        </span>
                    </a>
                    <a class="nav-link" onclick="history.forward()">
                       <span class="icon">
                            <i class="fas fa-chevron-right"></i>
                        </span>
                    </a>}
                </div>
            </div>
        </div>
    </nav>


    <div class="ie-fixMinHeight">

        <!-- main container -->
        <div class="ctn">

            <nav class="sideNav">
                @if (@Model.Permissions.Contains(19))
                {<!-- search -->
                <a class="nav-link" id="nav-search" data-toggle="clps" data-target="sr-cls" data-tooltip="Open Search">
                    <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z" /></svg>
                </a>            }
                @RenderSection("Side_Links", false)
            </nav>

            <div class="nb-cmbsWrp"><ul class="nb-cmbs"></ul></div>
            <div class="body">
                <div class="body-main">

                    <!-- search -->
                    @if (@Model.Permissions.Contains(19))
                    {
                        var search_placeholder = "type to search..";
                    @if (Context.Request.Path == "/users")
        {
            search_placeholder = "search for users..";
        }
        else if (Context.Request.Path == "/terms")
        {
            search_placeholder = "search for terms..";
        }
        else if (Context.Request.Path == "/collections")
        {
            search_placeholder = "search for collections..";
        }
        else if (Context.Request.Path == "/initiatives")
        {
            search_placeholder = "search for initiatives..";
        }
        else if (Context.Request.Path == "/groups")
        {
            search_placeholder = "search for groups..";
        }
                    <div class='clps clps-o' id="sr-cls">
                        <div class="sr-grp">
                            <input type="text" placeholder="@search_placeholder" value='@{try
                                    {@Model.SearchString}catch{}}' maxlength="80" required />
                            <!--<icon class="sr-fav"><i class="far fa-star"></i></icon>-->
                            <icon><svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z" /></svg></icon>
                            <div class="sr-hst"></div>
                        </div>
                    </div>}

                    <div class="body-mainCtn">
                        @RenderBody()
                    </div>

                </div>

                <!-- sidebar -->
                <div class="body-side" id="AdColTwo">
                    @if (ViewBag.AdLists != null)
                    {
                    <div id="related-reports"></div>
                    @foreach (var ad in ViewBag.AdLists)
                        {
                    <div class="col" data-ajax="yes" data-url="@ad.Url"></div>}}
                </div>
            </div>

            <!-- footer -->
            <partial name="_Footer" />
            <button id="back-to-top" class="back-to-top" role="button"><svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z" /></svg></button>

        </div>
    </div>

    <div class="prg"><div class="prg-b" style="width: 0%"></div></div>
    <div class="mail-notification-container"></div>
    <partial name="_Messagebox" />
    <partial name="modals\_Modals" />
    <partial name="modals\_image" />

    <div class="no-loader" data-ajax="yes" data-url="/index?Handler=WelcomeVideo" data-loadtag=".video"></div>



    <!-- javascript.. insane way to load js in order to keep c# hashtag -->
    <textarea style="display:none" class="postLoadScripts"><script src="/js/search.min.js" async></script><script src="/js/utility.min.js" async></script>@if(!Context.Request.Headers["User-Agent"].ToString().Contains("Trident")){<script src="/js/code.min.js" async></script>}</textarea>
    <textarea style="display:none" class="tabScripts"><script src="/js/tabs.min.js"></script></textarea>
    <textarea style="display:none" class="polyfillScripts"><script src="/js/polyfill.min.js"></script></textarea>
    <textarea style="display:none" class="collapseScripts"><script src="/js/collapse.min.js" async></script></textarea>
    <textarea style="display:none" class="carouselScripts"><script src="/js/carousel.min.js" async></script></textarea>
    <textarea style="display:none" class="tableScripts"><script src="/js/table.min.js" async></script></textarea>
    <textarea style="display:none" class="dragScripts"><script src="/js/drag.min.js" async></script></textarea>
    <textarea style="display:none" class="chartScripts"><script src="/js/charts.min.js" async></script></textarea>
    <textarea style="display:none" class="inputScripts"><script src="/js/input.min.js" async></script></textarea>
    <textarea style="display:none" class="commentsScripts"><script src="/js/comments.min.js" async></script></textarea>
    <textarea style="display:none" class="dropdownScripts"><script src="/js/dropdown.min.js" async></script></textarea>
    <script src="/js/main.min.js"></script>

    @RenderSection("js", required: false)
</body>
</html>
