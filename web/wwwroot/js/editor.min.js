"use strict";!function(){var i=0;function n(){if(50!=i)if("undefined"==typeof CodeMirror)setTimeout(function(){i++,n()},100);else{i=0;var t,e=Array.prototype.slice.call(document.querySelectorAll(".editor:not(.loaded)"));for(t=0;t<e.length;t++)new r(e[t])}}function r(t){this.mdrequest=null,this.target=t,this.target.classList.add("loaded"),this.editorInput=document.createElement("div"),this.editorInput.classList.add("liveEditor","box","p-0","pb-2"),this.editorBody=document.createElement("div"),this.editorBody.classList.add("liveEditor-body","p-2"),this.editorText=document.createElement("textarea"),this.editorText.classList.add("textarea");t="";0<this.target.getElementsByTagName("textarea").length&&(t=this.target.getElementsByTagName("textarea")[0].value,this.target.removeChild(this.target.getElementsByTagName("textarea")[0])),this.editorText.setAttribute("id",this.target.getAttribute("data-inputId")),this.editorText.setAttribute("name",this.target.getAttribute("data-inputName")),this.editorBody.appendChild(this.editorText),this.editorPrev=document.createElement("div"),this.editorPrev.classList.add("editor-liveEditorPrev","is-hidden","p-2"),this.editorPrevText=document.createElement("div"),this.editorPrev.appendChild(this.editorPrevText),this.btn=document.createElement("div"),this.btn.classList.add("liveEditor-btnGrp","has-background-white-ter","is-flex","is-justify-content-space-between"),this.btnLeft=document.createElement("span"),this.btnLeft.classList.add("is-flex"),this.btnRight=document.createElement("span"),this.btnRight.classList.add("is-flex"),this.btn.appendChild(this.btnLeft),this.btn.appendChild(this.btnRight),this.btnBold=document.createElement("button"),this.btnBold.classList.add("liveEditor-btn","button","is-light"),this.btnBold.setAttribute("type","button"),this.btnBold.innerHTML='<span class="icon"><i class="fas fa-bold"></i></span>',this.btnLeft.appendChild(this.btnBold),this.btnBold.addEventListener("click",this.insertBold.bind(this),!1),this.btnItalic=document.createElement("button"),this.btnItalic.classList.add("liveEditor-btn","button","is-light"),this.btnItalic.setAttribute("type","button"),this.btnItalic.innerHTML='<span class="icon"><i class="fas fa-italic"></i></span>',this.btnLeft.appendChild(this.btnItalic),this.btnItalic.addEventListener("click",this.insertItalics.bind(this),!1),this.btnHeading=document.createElement("button"),this.btnHeading.classList.add("liveEditor-btn","button","is-light"),this.btnHeading.setAttribute("type","button"),this.btnHeading.innerHTML='<span class="icon"><i class="fas fa-heading"></i></span>',this.btnLeft.appendChild(this.btnHeading),this.btnHeading.addEventListener("click",this.insertHeading.bind(this),!1),this.btnHeadingSep=document.createElement("span"),this.btnHeadingSep.classList.add("liveEditor-btnSep"),this.btnLeft.appendChild(this.btnHeadingSep),this.btnQuote=document.createElement("button"),this.btnQuote.classList.add("liveEditor-btn","button","is-light"),this.btnQuote.setAttribute("type","button"),this.btnQuote.innerHTML='<span class="icon"><i class="fas fa-quote-left"></i></span>',this.btnLeft.appendChild(this.btnQuote),this.btnQuote.addEventListener("click",this.insertQuote.bind(this),!1),this.btnCode=document.createElement("button"),this.btnCode.classList.add("liveEditor-btn","button","is-light"),this.btnCode.setAttribute("type","button"),this.btnCode.innerHTML='<span class="icon"><i class="fas fa-code"></i></span>',this.btnLeft.appendChild(this.btnCode),this.btnCode.addEventListener("click",this.insertCode.bind(this),!1),this.btnCodeSep=document.createElement("span"),this.btnCodeSep.classList.add("liveEditor-btnSep"),this.btnLeft.appendChild(this.btnCodeSep),this.btnUl=document.createElement("button"),this.btnUl.classList.add("liveEditor-btn","button","is-light"),this.btnUl.setAttribute("type","button"),this.btnUl.innerHTML='<span class="icon"><i class="fas fa-list-ul"></i></span>',this.btnLeft.appendChild(this.btnUl),this.btnUl.addEventListener("click",this.insertUl.bind(this),!1),this.btnOl=document.createElement("button"),this.btnOl.classList.add("liveEditor-btn","button","is-light"),this.btnOl.setAttribute("type","button"),this.btnOl.innerHTML='<span class="icon"><i class="fas fa-list-ol"></i></span>',this.btnLeft.appendChild(this.btnOl),this.btnOl.addEventListener("click",this.insertOl.bind(this),!1),this.btnOlSep=document.createElement("span"),this.btnOlSep.classList.add("liveEditor-btnSep"),this.btnLeft.appendChild(this.btnOlSep),this.btnLink=document.createElement("button"),this.btnLink.classList.add("liveEditor-btn","button","is-light"),this.btnLink.setAttribute("type","button"),this.btnLink.innerHTML='<span class="icon"><i class="fas fa-link"></i></span>',this.btnLeft.appendChild(this.btnLink),this.btnLink.addEventListener("click",this.insertLink.bind(this),!1),this.editorInput.appendChild(this.btn),this.target.getAttribute("data-saveUrl")&&(this.btnSave=document.createElement("button"),this.btnSave.classList.add("liveEditor-btn","button","is-light"),this.btnSave.classList.add("save"),this.btnSave.setAttribute("type","button"),this.btnSave.innerHTML='<span class="icon"><i class="fas fa-save"></i></span>',this.btnSave.addEventListener("click",this.save.bind(this),!1),this.btnRight.appendChild(this.btnSave),this.saveUrl=this.target.getAttribute("data-saveUrl")),this.editorPrevTitleButton=document.createElement("button"),this.editorPrevTitleButton.setAttribute("type","button"),this.editorPrevTitleButton.innerHTML='<span class="icon"><i class="fas fa-eye"></i></span>',this.editorPrevTitleButton.classList.add("liveEditor-btn","button","is-light"),this.editorPrevTitleButton.classList.add("save"),this.btnRight.appendChild(this.editorPrevTitleButton),this.editorInput.appendChild(this.editorBody),this.target.appendChild(this.editorInput),this.editorInput.appendChild(this.editorPrev),this.mirror=CodeMirror.fromTextArea(this.editorText,{mode:"gfm",autoRefresh:!0,viewportMargin:1/0,lineWrapping:!0}),this.mirror.setValue(t),this.mirror.getInputField().spellcheck=!0,this.md=window.markdownit({html:!0,linkify:!0,typographer:!0,breaks:!1}),this.editorPrevTitleButton.addEventListener("click",this.updateMirror.bind(this),!1),this.target.closest(".mdl")&&this.target.closest(".mdl").addEventListener("mdl-open",this.updateMirror.bind(this))}var s=document.requestAnimationFrame||document.setImmediate||function(t){return setTimeout(t,0)};r.prototype={updateMirror:function(){var e=this,i=this.md,n=this.editorPrevTitleButton;s(function(){var t=n.querySelector("i.fas");t.classList.contains("fa-eye")?(e.editorPrevText.innerHTML=i.render(e.mirror.getValue()),t.classList.remove("fa-eye"),t.classList.add("fa-eye-slash"),e.editorPrev.classList.remove("is-hidden"),e.editorBody.classList.add("is-hidden"),(e.btnLeft.querySelectorAll("button")||[]).forEach(function(t){t.setAttribute("disabled","disabled")}),document.dispatchEvent(new CustomEvent("code-highlight")),document.dispatchEvent(new CustomEvent("load-charts"))):(t.classList.remove("fa-eye-slash"),t.classList.add("fa-eye"),e.editorPrev.classList.add("is-hidden"),(e.btnLeft.querySelectorAll("button")||[]).forEach(function(t){t.removeAttribute("disabled")}),e.editorBody.classList.remove("is-hidden"))})},insertBold:function(){var i=this;s(function(){var t=i.mirror.findWordAt(i.mirror.getCursor()),e=i.mirror.getSelection().trim();0<i.mirror.getSelection().length?i.mirror.replaceSelection("**"+i.mirror.getSelection().trim()+"**"):(i.mirror.setSelection(t.anchor,t.head),i.mirror.replaceSelection("**"+(e=""==e?"bold text":e)+"**")),i.mirror.focus()})},insertItalics:function(){var i=this;s(function(){var t=i.mirror.findWordAt(i.mirror.getCursor()),e=i.mirror.getSelection().trim();0<i.mirror.getSelection().length?i.mirror.replaceSelection("*"+i.mirror.getSelection().trim()+"*"):(i.mirror.setSelection(t.anchor,t.head),i.mirror.replaceSelection("*"+(e=""==e?"italic text":e)+"*")),i.mirror.focus()})},insertHeading:function(){var n=this;s(function(){var t=n.mirror.getCursor().line,e=n.mirror.getLine(t),i=e.split(" ")[0];""==e?n.mirror.replaceRange("# Heading",{line:t,ch:0}):"#"!=i[0]?n.mirror.replaceRange("# ",{line:t,ch:0}):6<=(i.match(/#/g)||[]).length?n.mirror.replaceRange(e.substring(e.indexOf(" ")+1),{line:t,ch:0},{line:t,ch:e.length}):n.mirror.replaceRange("#",{line:t,ch:0}),n.mirror.focus()})},insertQuote:function(){var i=this;s(function(){var t=i.mirror.findWordAt(i.mirror.getCursor()),e=i.mirror.getSelection().trim();0<i.mirror.getSelection().length?(i.mirror.setSelection({line:Math.min(i.mirror.listSelections()[0].head.line,i.mirror.listSelections()[0].anchor.line),ch:0},{line:Math.max(i.mirror.listSelections()[0].head.line,i.mirror.listSelections()[0].anchor.line),ch:1}),i.mirror.replaceSelection("> "+i.mirror.getSelection().replace(/\n/g,function(){return"\n> "}))):(i.mirror.setSelection({line:Math.min(t.head.line,t.anchor.line),ch:0},{line:Math.max(t.head.line,t.anchor.line),ch:1}),""==e?i.mirror.replaceSelection("> fancy blockquote"):i.mirror.replaceSelection("> "+e)),i.mirror.focus()})},insertCode:function(){var i=this;s(function(){var t=i.mirror.findWordAt(i.mirror.getCursor()),e=i.mirror.getSelection().trim();0<i.mirror.getSelection().length?i.mirror.replaceSelection("\n```sql\n"+i.mirror.getSelection()+"\n```\n"):(i.mirror.setSelection(t.anchor,t.head),""==e?i.mirror.replaceSelection("\n```sql\nselect smiles; -- :) --\n```\n"):i.mirror.replaceSelection("`"+e+"`")),i.mirror.focus()})},insertUl:function(){var i=this;s(function(){var t=i.mirror.findWordAt(i.mirror.getCursor()),e=i.mirror.getSelection().trim();0<i.mirror.getSelection().length?(i.mirror.setSelection({line:Math.min(i.mirror.listSelections()[0].head.line,i.mirror.listSelections()[0].anchor.line),ch:0},{line:Math.max(i.mirror.listSelections()[0].head.line,i.mirror.listSelections()[0].anchor.line),ch:1}),i.mirror.replaceSelection("- "+i.mirror.getSelection().replace(/\n/g,function(){return"\n- "}))):(i.mirror.setSelection({line:Math.min(t.head.line,t.anchor.line),ch:0},{line:Math.max(t.head.line,t.anchor.line),ch:1}),""==e?i.mirror.replaceSelection("- item one\n- item two\n- item three"):i.mirror.replaceSelection("- "+e)),i.mirror.focus()})},insertOl:function(){var n=this;s(function(){var t,e=n.mirror.findWordAt(n.mirror.getCursor()),i=n.mirror.getSelection().trim();0<n.mirror.getSelection().length?(n.mirror.setSelection({line:Math.min(n.mirror.listSelections()[0].head.line,n.mirror.listSelections()[0].anchor.line),ch:0},{line:Math.max(n.mirror.listSelections()[0].head.line,n.mirror.listSelections()[0].anchor.line),ch:1}),t=1,n.mirror.replaceSelection(t+". "+n.mirror.getSelection().replace(/\n/g,function(){return"\n"+ ++t+". "}))):(n.mirror.setSelection({line:Math.min(e.head.line,e.anchor.line),ch:0},{line:Math.max(e.head.line,e.anchor.line),ch:1}),""==i?n.mirror.replaceSelection("1. item one\n2. item two\n3. item three"):n.mirror.replaceSelection("1. "+i)),n.mirror.focus()})},insertLink:function(){var t=this;s(function(){0<t.mirror.getSelection().length?t.mirror.replaceSelection("["+t.mirror.getSelection().trim()+"](https://atlas)"):t.mirror.replaceSelection("[Link Title](https://atlas)"),t.mirror.focus()})},save:function(){var i=this;s(function(){var t={},e=(t.id=getUrlVars().id,t.description=i.mirror.getValue(),new XMLHttpRequest);e.open("post",i.saveUrl,!0),e.setRequestHeader("Content-Type","text/plain;charset=UTF-8`"),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.send(JSON.stringify(t)),e.onload=function(){document.getElementById("editorMdl-titleSave").style.visibility="visible",setTimeout(function(){document.getElementById("editorMdl-titleSave").style.removeProperty("visibility")},750)}})}},n(),document.addEventListener("ajax",function(){n()})}(),function(){function t(){for(var t=i.querySelectorAll(".form-check:not(.loaded)"),e=0;e<t.length;e++)!function(t){t.classList.add("loaded");var e=t.querySelector("#editModal input[type=checkbox]"),i=t.querySelector("#editModal input[type=hidden");e&&i&&(e.checked="Y"==i.value,e.addEventListener("change",function(){i.value=e.checked?"Y":"N"}))}(t[e])}var i=document;t(),i.addEventListener("ajax",function(){t()})}(),function(){function t(){for(var t=i.querySelectorAll(".toggle"),e=0;e<t.length;e++)!function(t){t.classList.add("loaded");var e=t.querySelector("input[type=checkbox]"),i=t.querySelector("input[type=hidden");e&&i&&(e.checked="Y"==i.value,e.addEventListener("change",function(){i.value=e.checked?"Y":"N"}))}(t[e])}var i=document;t(),i.addEventListener("ajax",function(){t()})}(),function(){function c(t){for(var e=t.querySelectorAll('input[type="hidden"][name]:not(.drag)'),i=0;i<e.length;i++)e[i].setAttribute("name",e[i].getAttribute("name").replace(/\[\d*?\]/,"["+i+"]"))}(document.querySelector("#images .images.reorder")||{addEventListener:function(){}}).addEventListener("reorder",function(t){c(t.target)}),(document.querySelector(".new-image input")||{addEventListener:function(){}}).addEventListener("change",function(t){t.preventDefault();var e=document.createElement("div"),i=(e.classList.add("box","p-0","m-3","drg"),document.createElement("input")),n=(i.type="hidden",i.setAttribute("name","Images[999].Imageid"),document.createElement("div")),r=(n.classList.add("has-background-white-ter","is-flex","is-justify-content-space-between"),document.createElement("button")),s=(r.setAttribute("type","button"),r.classList.add("button","is-light","drg-hdl"),r.innerHTML='<span class="icon"><i class="fas fa-arrows-alt"></i></span>',document.createElement("button")),o=(s.setAttribute("type","button"),s.classList.add("button","is-light","action-delete"),s.innerHTML='<span class="icon"><i class="fas fa-circle-notch fa-spin"></i></span>',document.createElement("figure")),a=(o.classList.add("image","is-256x256"),document.createElement("picture")),l=document.createElement("img"),r=(l.setAttribute("src",window.URL.createObjectURL(t.target.files[0])),l.style.width="auto",l.style.maxWidth="100%",l.style.maxHeight="100%",e.appendChild(i),e.appendChild(n),n.appendChild(r),n.appendChild(s),e.appendChild(o),o.appendChild(a),a.appendChild(l),document.querySelector(".images.reorder .new-image").closest(".box")),n=(r.parentNode.insertBefore(e,r),new FormData),d=(n.append("File",t.target.files[0]),new XMLHttpRequest);d.open("post","/reports/edit/?handler=AddImage&Id="+getUrlVars().id,!0),d.withCredentials=!0,d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.send(n),d.onload=function(){"error"==d.responseText?s.innerHTML='<span class="icon has-text-danger"><i class="fas fa-exclamation-triangle"></i></span>':(s.innerHTML='<span class="icon"><i class="fas fa-trash"></i></span>',i.value=d.responseText,s.addEventListener("click",function(t){t.preventDefault(),e.parentNode.removeChild(e)}))},c(document.querySelector(".images.reorder"))}),(document.querySelectorAll(".images button.action-delete")||[]).forEach(function(e){e.addEventListener("click",function(t){t.preventDefault();t=e.closest(".box");t.parentNode.removeChild(t)})})}();